<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boletim de Atividades Mecanizadas</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50"/>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }

    #installBtn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Boletim de Atividades Mecanizadas</h1>

  <h2>Boletim de Operações</h2>

  <div id="operacoes-area">
    <div class="form-container">
      <form class="form-op">
        <div class="info-geral">
          <label>Nome do Operador:</label>
          <input type="text" name="operador" required>
          
          <label>Matrícula:</label> 
          <input type="text" name="matricula" required>

          <label>Data:</label>
          <input type="date" name="data" required>

          <label>Turno:</label>
          <select name="turno" required>
            <option value="1º Turno">1º Turno</option>
            <option value="2º Turno">2º Turno</option>
            <option value="3º Turno">3º Turno</option>
          </select>

          <label>Equipamento:</label>
          <select name="equipamento" required>
            <option value="100010">100010</option>
            <option value="100011">100011</option>
            <option value="100012">100012</option>
            <option value="100013">100013</option>
            <option value="100014">100014</option>
            <option value="100015">100015</option>
            <option value="100016">100016</option>
            <option value="100017">100017</option>
            <option value="100018">100018</option>
            <option value="100019">100019</option>
          </select>
        </div>

        <hr>

        <label for="operacao">Selecione a operação:</label>
        <select id="operacao">
          <option value="464">464 - APLICAÇÃO PRÉ EMERG AEREA C/DRONE</option>
          <option value="465">465 - APLICAÇÃO PÓS EMERG AEREA C/ DRONE</option>
          <option value="466">466 - APLICAÇÃO INSETICIDA AEREA - PULGÃO</option>
          <option value="467">467 - APLICAÇÃO INSETICIDA AEREA - CIGARRINHA</option>
          <option value="468">468 - APLICAÇÃO INSETICIDA AEREA - DIATREA</option>
          <option value="470">470 - APLICAÇÃO ADUBO FOLIAR AEREA C/ DRONE</option>
          <option value="471">471 - APLICAÇÃO MATURADOR AEREA C/ DRONE</option>
          <option value="472">472 - APLICAÇÃO INIBIDOR DE FLORECIMENTO AEREA C/ DRONE</option>
          <option value="480">480 - SEG APLIC PRE EMERGENCIA AEREA C/ DRONE</option>
          <option value="489">489 - POS EMERGEN RUAS E CANAIS AEREA C/ DRONE</option>
          <option value="490">490 - CULTIVO MINIMO AEREA C/ DRONE</option>
          <option value="491">491 - ERRADICAÇÃO DE ERVAS PERENES AEREA C/ DRONE</option>
          <option value="564">564 - FOLIAR E INSETICIDA PULGÃO</option>
          <option value="565">565 - FOLIAR E INSETICIDA CIGARRINHA</option>
          <option value="566">566 - FOLIAR E INSETICIDA DIATRÉIA</option>
          <option value="567">567 - FOLIAR E INSETICIDA LAGARTA</option>
          <option value="568">568 - FOLIAR E PÓS EMERGÊNCIA</option>
          <option value="946">946 - FORA DE PROGRAMAÇÃO</option>
          <option value="911">911 - AGUARDANDO PROGRAMAÇÃO</option>
          <option value="1029">1029 - CONDIÇOES DO TEMPO RUINS</option>
        </select>

        <label for="tipoCana">Selecione o tipo:</label>
        <select id="tipoCana">
          <option value="planta">Cana Planta</option>
          <option value="soca">Cana Soca</option>
        </select>

        <button type="button" onclick="mostrarCentroCusto()">Mostrar Centro de Custo</button>
        <div id="resultado"></div>

        <label>Campo:</label>
        <input type="text" name="campo" required>

        <label>Hectares:</label>
        <input type="text" name="hectares" required>

        <label>Hora Inicial:</label>
        <input type="time" name="hora_inicial" required>

        <label>Hora Final:</label>
        <input type="time" name="hora_final" required>

        <label>Horímetro Inicial:</label>
        <input type="text" name="horimetro_inicial" required>

        <label>Horas Operadas:</label>
        <input type="text" name="horas_operadas" required>

        <label>Horímetro Final (calculado):</label>
        <input type="text" name="horimetro_final" readonly>

        <div class="buttons">
          <button type="button" onclick="calcularHorimetro()">Calcular Horímetro Final</button>
          <button type="reset">Limpar</button>
        </div>

        <div class="buttons">
          <button type="button" onclick="voltar()">Voltar</button>
          <button type="submit">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="no-print">
    <button onclick="inserirNovaOperacao()">Inserir Nova Operação</button>
    <button onclick="gerarTabela()">Salvar em PDF</button>

  </div>

  <script>
    const centroCusto = {
      "464": { planta: "702", soca: "703" },
      "465": { planta: "1635", soca: "1636" },
      "466": { planta: "82", soca: "101" },
      "467": { planta: "82", soca: "101" },
      "468": { planta: "82", soca: "101" },
      "470": { planta: "81", soca: "100" },
      "471": { planta: "79", soca: "98" },
      "472": { planta: "867", soca: "868" },
      "480": { planta: "702", soca: "703" },
      "489": { planta: "1635", soca: "1636" },
      "490": { planta: "1635", soca: "1636" },
      "491": { planta: "1635", soca: "1636" },
      "564": { planta: "2610", soca: "2615" },
      "565": { planta: "2611", soca: "2616" },
      "566": { planta: "2612", soca: "2617" },
      "567": { planta: "2613", soca: "2618" },
      "568": { planta: "2614", soca: "2619" },
      "946": { planta: "999", soca: "999" },
      "911": { planta: "999", soca: "999" },
      "1029": { planta: "999", soca: "999" }
    };

    function mostrarCentroCusto() {
      const op = event.target.closest(".form-container");
      const operacao = op.querySelector("#operacao").value;
      const tipoCana = op.querySelector("#tipoCana").value;
      const resultado = op.querySelector("#resultado");
      const centro = centroCusto[operacao]?.[tipoCana];
      resultado.innerText = centro ? `Centro de Custo: ${centro}` : "Centro de Custo não encontrado.";
    }

    function calcularHorimetro() {
      const op = event.target.closest(".form-container");
      const inicial = parseFloat(op.querySelector('[name="horimetro_inicial"]').value.replace(',', '.'));
      const operadas = parseFloat(op.querySelector('[name="horas_operadas"]').value.replace(',', '.'));
      if (!isNaN(inicial) && !isNaN(operadas)) {
        const resultado = (inicial + operadas).toFixed(2);
        op.querySelector('[name="horimetro_final"]').value = resultado.replace('.', ',');
      }
    }

    function inserirNovaOperacao() {
      const area = document.getElementById("operacoes-area");
      const original = document.querySelector(".form-container");
      const clone = original.cloneNode(true);
      const campos = clone.querySelectorAll("input, select");
      campos.forEach(campo => {
        if (!campo.closest(".info-geral")) {
          campo.value = "";
        }
      });
      area.appendChild(clone);
    }

    function voltar() {
      window.history.back();
    }
  </script>


<div id="print-area"></div>

<script>
  function gerarTabela() {
    const get = name => document.getElementsByName(name)[0]?.value || '';

    const tabela = `
      <table>
        <caption>Boletim de Atividades Mecanizadas</caption>
        <tr>
          <td><strong>Nome do Operador</strong><br>${get('operador')}</td>
          <td><strong>Data</strong><br>${get('data')}</td>
          <td><strong>Matrícula</strong><br>${get('matricula')}</td>
          <td><strong>Equipamento</strong><br>${get('equipamento')}</td>
          <td><strong>Turno</strong><br>${get('turno')}</td>
          <td><strong>Horas Operadas</strong><br>${get('horas_operadas')}</td>
        </tr>
        <tr>
          <td><strong>Centro de Custo</strong><br>${get('centroCusto')}</td>
          <td><strong>Operação</strong><br>${get('operacao')}</td>
          <td><strong>Hora Inicial</strong><br>${get('horaInicial')}</td>
          <td><strong>Hora Final</strong><br>${get('horaFinal')}</td>
          <td><strong>Campo</strong><br>${get('campo')}</td>
          <td><strong>Hectares</strong><br>${get('hectares')}</td>
        </tr>
        <tr>
          <td colspan="3"><strong>Horímetro Inicial</strong><br>${get('horimetroInicial')}</td>
          <td colspan="3"><strong>Horímetro Final</strong><br>${get('horimetroFinal')}</td>
        </tr>
      </table>`;

    document.getElementById("print-area").innerHTML = tabela;
    window.print();
  }
</script>
<div id="print-area"></div>

<script>
  function gerarTabela() {
    const containers = document.querySelectorAll(".form-container");
    let tabelas = '';

    containers.forEach((container, index) => {
      const get = name => container.querySelector(`[name="${name}"]`)?.value || '';
      const getById = id => container.querySelector(`#${id}`)?.value || '';
      const centroCusto = container.querySelector("#resultado")?.innerText || '';

      const tabela = `
        <table style="margin-bottom: 30px;">
          <caption>Boletim de Atividades Mecanizadas - Operação ${index + 1}</caption>
          <tr>
            <td><strong>Nome do Operador</strong><br>${get("operador")}</td>
            <td><strong>Data</strong><br>${get("data")}</td>
            <td><strong>Matrícula</strong><br>${get("matricula")}</td>
            <td><strong>Equipamento</strong><br>${get("equipamento")}</td>
            <td><strong>Turno</strong><br>${get("turno")}</td>
            <td><strong>Horas Operadas</strong><br>${get("horas_operadas")}</td>
          </tr>
          <tr>
            <td><strong>Centro de Custo</strong><br>${centroCusto.replace("Centro de Custo:", "").trim()}</td>
            <td><strong>Operação</strong><br>${getById("operacao")}</td>
            <td><strong>Hora Inicial</strong><br>${get("hora_inicial")}</td>
            <td><strong>Hora Final</strong><br>${get("hora_final")}</td>
            <td><strong>Campo</strong><br>${get("campo")}</td>
            <td><strong>Hectares</strong><br>${get("hectares")}</td>
          </tr>
          <tr>
            <td colspan="3"><strong>Horímetro Inicial</strong><br>${get("horimetro_inicial")}</td>
            <td colspan="3"><strong>Horímetro Final</strong><br>${get("horimetro_final")}</td>
          </tr>
        </table>`;
      tabelas += tabela;
    });

    document.getElementById("print-area").innerHTML = tabelas;
    window.print();
  }
</script>

  <!-- Botão de instalação -->
  <button id="installBtn">Instalar App</button>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker registrado'))
        .catch(err => console.error('Erro ao registrar o SW:', err));
    }
  </script>

  <!-- Script de instalação -->
  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';

      installBtn.addEventListener('click', () => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('Usuário aceitou a instalação');
          } else {
            console.log('Usuário recusou a instalação');
          }
          deferredPrompt = null;
        });
      });
    });
  </script>
</body>
</html>
